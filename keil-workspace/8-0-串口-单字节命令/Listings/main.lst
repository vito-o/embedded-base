C51 COMPILER V9.54   MAIN                                                                  11/08/2024 17:33:23 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\software\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Delay.h"
   3          #include <string.h>
   4          
   5          void init_UART()
   6          {
   7   1          // 1.è®¾ç½®ä¸²å£å·¥ä½œæ¨¡å¼
   8   1          SM0 = 0;
   9   1          SM1 = 1;
  10   1        
  11   1          // 2.è®¾ç½®æ³¢ç‰¹ç‡
  12   1          // 2.1 SMOD
  13   1          PCON &= 0x7F;
  14   1          // 2.2 å®šæ—¶å™¨1
  15   1          // 2.2.1 å·¥ä½œæ¨¡å¼è®¾ç½®
  16   1          TMOD &= 0x0F;
  17   1          TMOD |= 0x20;
  18   1          // 2.2.2 æº¢å‡ºåˆå§‹å€¼è®¾ç½®
  19   1          // æ„æ€å°±æ˜¯è¿‡æ¥çš„æ—¶é’Ÿé¢‘ç‡ åœ¨253çš„åŸºç¡€ä¸Šï¼Œæ¯ä¸ªæ—¶é’Ÿé¢‘ç‡åŠ 1ï¼Œ è¾¾åˆ°æº¢å‡ºæ‰äº§ç”
             -Ÿä¸€æ¬¡å®šæ—¶
  20   1          TL1 = 253;
  21   1          TH1 = 253;
  22   1          // 2.2.3 å¯åŠ¨å®šæ—¶å™¨
  23   1          TR1 = 1;
  24   1        
  25   1          // 3.æ¥æ”¶æ•°æ®ç›¸å…³
  26   1          REN = 1; //å¼€å¯æ•°æ®æ¥æ”¶
  27   1          SM2 = 0; //æ˜¯å¦æ£€æµ‹åœæ­¢ä½çš„æœ‰æ•ˆæ€§ï¼ˆé«˜ç”µå¹³æœ‰æ•ˆï¼‰ 1:æ£€æµ‹ï¼Œ0ï¼šä¸æ£€æµ‹  
  28   1          
  29   1          // 4.ä¸²å£ä¸­æ–­ç›¸å…³é…ç½®
  30   1          ES = 1;
  31   1          EA = 1;
  32   1          
  33   1          RI = 0;
  34   1          TI = 0;
  35   1      }
  36          // æ˜¯å¦æ­£åœ¨å‘é€
  37          static char bit_is_sending = 0;
  38          static char s_buffer = 0;
  39          
  40          // å‘é€ä¸€ä¸ªå­—ç¬¦æ•°æ®
  41          void UART_sendChar(char c)
  42          {
  43   1        while(bit_is_sending == 1);
  44   1        bit_is_sending = 1;
  45   1        SBUF = c;
  46   1      }
  47          
  48          // å‘é€å­—ç¬¦ä¸²
  49          void UART_sendStr(char *str)
  50          {
  51   1        while(*str != '\0') {
  52   2          UART_sendChar(*str);
  53   2          str++;
C51 COMPILER V9.54   MAIN                                                                  11/08/2024 17:33:23 PAGE 2   

  54   2        } 
  55   1      }
  56          
  57          // éªŒè¯æ˜¯å¦æ¥æ”¶æ•°æ®
  58          bit UART_receiveChar(char *c)
  59          {
  60   1        if (s_buffer) {
  61   2          *c = s_buffer;
  62   2          s_buffer = 0;
  63   2          return 1;
  64   2        } else {
  65   2          return 0;
  66   2        }
  67   1      }
  68          
  69          
  70          char c;
  71          void main() 
  72          {
  73   1        init_UART();
  74   1        
  75   1        while(1)
  76   1        {
  77   2          if (UART_receiveChar(&c)) {
  78   3            if(c == 'A') {
  79   4              P2 = 0x00;
  80   4              UART_sendStr("ok: LED is on");
  81   4            } else if (c == 'B') {
  82   4              P2 = 0xFF;
  83   4              UART_sendStr("ok: LED is off");
  84   4            } else {
  85   4              UART_sendStr("Error: Unknown command");
  86   4            }
  87   3          }
  88   2        }
  89   1      
  90   1      }
  91          
  92          
  93          void UART_Routine(void) interrupt 4
  94          {
  95   1        if (RI == 1) {
  96   2          s_buffer = SBUF;
  97   2          
  98   2          RI = 0; //åœ¨ä¸­æ–­ä¸­æ‰‹åŠ¨å¯¹ä¸²å£æ ‡å¿—ä½é‡ç½®
  99   2        }
 100   1        
 101   1        if (TI == 1) {
 102   2          bit_is_sending = 0;
 103   2          
 104   2          TI = 0; //åœ¨ä¸­æ–­ä¸­æ‰‹åŠ¨å¯¹ä¸²å£æ ‡å¿—ä½é‡ç½®
 105   2        }
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    156    ----
   CONSTANT SIZE    =     52    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.54   MAIN                                                                  11/08/2024 17:33:23 PAGE 3   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
